--[[
    Uhhhhhh Reanimate GUI - è¶…ç‚«é…·æ§åˆ¶é¢æ¿
    åŠŸèƒ½ï¼š
        - ä¸€é”®è¿›å…¥æ°¸ä¹…æ­»äº¡çŠ¶æ€ï¼Œæ•è·æ‰è½å¸½å­
        - å¸½å­ç¢°æ’ï¼šè®©å¸½å­æˆä¸ºç‰©ç†éšœç¢
        - å¸½å­ç”©é£ï¼šå°†å¸½å­ä½œä¸ºå¯¼å¼¹æ”»å‡»ç›®æ ‡
        - ç‚«é…·UIï¼šåŠ¨æ€æ¸å˜ã€å‘å…‰ã€åŠ¨ç”»
    ç¯å¢ƒéœ€æ±‚ï¼šæ”¯æŒ sethiddenproperty / isnetworkowner çš„æ‰§è¡Œå™¨ï¼ˆKrnl, Synapseç­‰ï¼‰
]]

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- ==================== è¾…åŠ©å‡½æ•° ====================
local function IsNetworkOwner(part)
    return part and (isnetworkowner and isnetworkowner(part) or true) -- è‹¥ä¸å­˜åœ¨åˆ™é»˜è®¤çœŸ
end

local function SetUACFrameNetless(handle, dt, targetCF, extraVel, spin)
    if not IsNetworkOwner(handle) then return false end
    local vel = (targetCF.Position - handle.Position) / dt
    if vel.Magnitude > 16384 then vel = vel.Unit * 16384 end
    handle.CFrame = targetCF
    handle.AssemblyLinearVelocity = vel + (extraVel or Vector3.new())
    if spin then
        handle.AssemblyAngularVelocity = Vector3.new(16384, 16384, 16384)
    end
    return true
end

-- ==================== æ ¸å¿ƒçŠ¶æ€ ====================
local Reanim = {
    Active = false,               -- æ˜¯å¦å·²è¿›å…¥æ­»äº¡çŠ¶æ€
    DeadParts = {},               -- æ­»äº¡åæ‰è½çš„å¸½å­Handleåˆ—è¡¨
    FlingTarget = nil,            -- å½“å‰ç”©é£ç›®æ ‡
    FlingConn = nil,              -- ç”©é£å¾ªç¯è¿æ¥
    CollideEnabled = false,
    FlingEnabled = false,
    SelectedMethod = "All",       -- ç”©é£æ–¹æ³•: "All" / "Biggest" / "Tool"
}

-- ==================== UI æ„å»º ====================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UhhhhhhGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- ä¸»æ¡†æ¶ (ç‚«é…·åŠé€æ˜èƒŒæ™¯)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 320, 0, 260)
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -130)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- åœ†è§’ + é˜´å½±
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(0, 200, 255)
UIStroke.Thickness = 1.5
UIStroke.Transparency = 0.6
UIStroke.Parent = MainFrame

-- æ‹–åŠ¨åŠŸèƒ½
local DragDetector = Instance.new("DragDetector")  -- æŸäº›æ‰§è¡Œå™¨å¯èƒ½æ²¡æœ‰ï¼Œå¯ç”¨UserInputServiceæ¨¡æ‹Ÿï¼Œæ­¤å¤„ç®€åŒ–
DragDetector.Parent = MainFrame
-- å¦‚æœDragDetectorä¸å¯ç”¨ï¼Œå¯ç”¨ç»å…¸æ‹–åŠ¨ä»£ç ï¼Œä½†ä¸ºäº†ç®€æ´ç•¥è¿‡

-- æ ‡é¢˜
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "âš¡ UHHHHH REANIMATE âš¡"
Title.TextColor3 = Color3.fromRGB(0, 230, 255)
Title.TextStrokeTransparency = 0.3
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

-- è£…é¥°å…‰æ¡
local TopGlow = Instance.new("Frame")
TopGlow.Size = UDim2.new(1, -20, 0, 3)
TopGlow.Position = UDim2.new(0, 10, 0, 40)
TopGlow.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
TopGlow.BorderSizePixel = 0
TopGlow.Parent = MainFrame
local GlowCorner = Instance.new("UICorner")
GlowCorner.CornerRadius = UDim.new(0, 4)
GlowCorner.Parent = TopGlow

-- çŠ¶æ€æŒ‡ç¤º
local StatusText = Instance.new("TextLabel")
StatusText.Size = UDim2.new(1, -20, 0, 25)
StatusText.Position = UDim2.new(0, 10, 0, 50)
StatusText.BackgroundTransparency = 1
StatusText.Text = "â›” æœªæ¿€æ´»"
StatusText.TextColor3 = Color3.fromRGB(255, 80, 80)
StatusText.TextXAlignment = Enum.TextXAlignment.Left
StatusText.TextScaled = true
StatusText.Font = Enum.Font.Gotham
StatusText.Parent = MainFrame

-- æŒ‰é’®å®¹å™¨
local ButtonHolder = Instance.new("Frame")
ButtonHolder.Size = UDim2.new(1, -20, 0, 120)
ButtonHolder.Position = UDim2.new(0, 10, 0, 85)
ButtonHolder.BackgroundTransparency = 1
ButtonHolder.Parent = MainFrame

-- åˆ›å»ºæŒ‰é’®å‡½æ•°
local function createButton(text, pos, color)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.5, -5, 0, 35)
    btn.Position = pos
    btn.Text = text
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextScaled = true
    btn.Font = Enum.Font.GothamBold
    btn.BackgroundColor3 = color
    btn.BorderSizePixel = 0
    btn.Parent = ButtonHolder

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn

    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(255,255,255)
    stroke.Thickness = 1
    stroke.Transparency = 0.7
    stroke.Parent = btn

    -- æ‚¬åœåŠ¨ç”»
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = color:Lerp(Color3.new(1,1,1), 0.3)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = color}):Play()
    end)
    return btn
end

-- æ”¾ç½®æŒ‰é’®ï¼šä¸¤åˆ—
local btn1 = createButton("ğŸ’€ æ­»äº¡", UDim2.new(0, 0, 0, 0), Color3.fromRGB(180, 0, 0))      -- æ¿€æ´»æ­»äº¡
local btn2 = createButton("ğŸ¯ ç¢°æ’", UDim2.new(0.5, 5, 0, 0), Color3.fromRGB(0, 100, 180))  -- å¸½å­ç¢°æ’
local btn3 = createButton("ğŸš€ ç”©é£", UDim2.new(0, 0, 0, 40), Color3.fromRGB(0, 150, 50))    -- å¼€å¯ç”©é£
local btn4 = createButton("âš™ï¸ æ–¹æ³•", UDim2.new(0.5, 5, 0, 40), Color3.fromRGB(150, 75, 0))  -- åˆ‡æ¢æ–¹æ³•
local btn5 = createButton("ğŸ¯ é€‰ç›®æ ‡", UDim2.new(0, 0, 0, 80), Color3.fromRGB(200, 0, 200)) -- é€‰æ‹©ç›®æ ‡
local btn6 = createButton("â¹ï¸ åœæ­¢", UDim2.new(0.5, 5, 0, 80), Color3.fromRGB(100, 100, 100))-- åœæ­¢æ‰€æœ‰

-- æ–¹æ³•æ˜¾ç¤º
local MethodLabel = Instance.new("TextLabel")
MethodLabel.Size = UDim2.new(1, 0, 0, 20)
MethodLabel.Position = UDim2.new(0, 0, 1, -25)
MethodLabel.BackgroundTransparency = 1
MethodLabel.Text = "å½“å‰ç”©é£æ–¹æ³•: All"
MethodLabel.TextColor3 = Color3.fromRGB(200,200,200)
MethodLabel.TextScaled = true
MethodLabel.Font = Enum.Font.Gotham
MethodLabel.Parent = MainFrame

-- ==================== åŠŸèƒ½å®ç° ====================

-- æ•è·æ‰è½çš„å¸½å­ (å½“è§’è‰²å­çº§ç§»é™¤æ—¶)
local function onChildRemoved(child)
    if not Reanim.Active then return end
    if child:IsA("Accessory") then
        local handle = child:FindFirstChild("Handle")
        if handle then
            -- å¸½å­å·²ç§»åŠ¨åˆ°å·¥ä½œåŒº
            handle.CanCollide = true
            handle.Anchored = false
            table.insert(Reanim.DeadParts, handle)
            StatusText.Text = "ğŸ© å¸½å­ +1  æ€»æ•°: "..#Reanim.DeadParts
        end
    end
end

-- è¿›å…¥æ°¸ä¹…æ­»äº¡çŠ¶æ€
local function activateDeath()
    if Reanim.Active then return end
    local char = LocalPlayer.Character
    if not char then return end

    -- æ–­å¼€è¿æ¥ä»¥é˜²åç»­ç›‘å¬
    if Reanim.DeathConn then Reanim.DeathConn:Disconnect() end

    -- ç›‘å¬å¸½å­æ‰è½
    Reanim.DeathConn = char.ChildRemoved:Connect(onChildRemoved)

    -- æ€æ­»è§’è‰² (é€šè¿‡è®¾ç½®å¥åº·ä¸º0å¹¶ç§»é™¤Humanoid)
    local humanoid = char:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.Health = 0
        humanoid:Destroy()  -- ç§»é™¤Humanoidé˜²æ­¢é‡ç”Ÿå’Œæ¸…ç†
    end

    -- å°†è§’è‰²éƒ¨ä»¶ç§»åŠ¨åˆ°å·¥ä½œåŒºï¼ˆé¿å…è¢«åˆ é™¤ï¼‰
    for _, part in ipairs(char:GetChildren()) do
        if part:IsA("BasePart") then
            part.Parent = Workspace
            part.CanCollide = true
            part.Anchored = false
        elseif part:IsA("Accessory") then
            -- é…ä»¶ä¹Ÿä¼šè¢«ç§»é™¤ï¼Œç”±ç›‘å¬å¤„ç†
        end
    end

    -- éšè—è§’è‰²æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
    char:Destroy()  -- å½»åº•ç§»é™¤ç©ºå£³

    Reanim.Active = true
    StatusText.Text = "ğŸ’€ æ­»äº¡æ¨¡å¼æ¿€æ´»  å¸½å­: "..#Reanim.DeadParts
    print("å·²è¿›å…¥æ°¸ä¹…æ­»äº¡çŠ¶æ€ï¼Œç­‰å¾…å¸½å­æ‰è½...")
end

-- å¯ç”¨å¸½å­ç¢°æ’ (å¯¹æ‰€æœ‰æ•è·çš„å¸½å­è®¾ç½®CanCollide)
local function enableCollide()
    if not Reanim.Active then
        StatusText.Text = "âš ï¸ è¯·å…ˆæ¿€æ´»æ­»äº¡æ¨¡å¼"
        return
    end
    Reanim.CollideEnabled = not Reanim.CollideEnabled
    if Reanim.CollideEnabled then
        for _, handle in ipairs(Reanim.DeadParts) do
            if handle and handle.Parent then
                handle.CanCollide = true
            end
        end
        StatusText.Text = "ğŸ›¡ï¸ å¸½å­ç¢°æ’å·²å¼€å¯"
    else
        for _, handle in ipairs(Reanim.DeadParts) do
            if handle and handle.Parent then
                handle.CanCollide = false
            end
        end
        StatusText.Text = "ğŸ›¡ï¸ å¸½å­ç¢°æ’å·²å…³é—­"
    end
end

-- é€‰æ‹©ç›®æ ‡ (é¼ æ ‡ç‚¹å‡»)
local function selectTarget()
    if not Reanim.Active then StatusText.Text = "âš ï¸ è¯·å…ˆæ¿€æ´»æ­»äº¡æ¨¡å¼" return end
    StatusText.Text = "ğŸ¯ ç‚¹å‡»ä¸€ä¸ªéƒ¨ä»¶é€‰æ‹©ç›®æ ‡"
    local conn
    conn = Mouse.Button1Down:Connect(function()
        local target = Mouse.Target
        if target then
            Reanim.FlingTarget = target
            StatusText.Text = "ğŸ¯ ç›®æ ‡: "..target.Name
            -- é«˜äº®ç›®æ ‡ (ç®€å•åŠ ä¸ªæ–¹æ¡†)
            local highlight = Instance.new("SelectionBox")
            highlight.Adornee = target
            highlight.Color3 = Color3.fromRGB(255, 0, 0)
            highlight.LineThickness = 0.1
            highlight.Transparency = 0.5
            highlight.Parent = Workspace
            game:GetService("Debris"):AddItem(highlight, 2)
        else
            StatusText.Text = "âŒ æœªé€‰ä¸­æœ‰æ•ˆéƒ¨ä»¶"
        end
        conn:Disconnect()
    end)
end

-- åˆ‡æ¢ç”©é£æ–¹æ³•
local methods = {"All", "Biggest", "Tool"}
local methodIndex = 1
local function switchMethod()
    methodIndex = methodIndex % 3 + 1
    Reanim.SelectedMethod = methods[methodIndex]
    MethodLabel.Text = "å½“å‰ç”©é£æ–¹æ³•: "..Reanim.SelectedMethod
end

-- è·å–å½“å‰æ–¹æ³•å¯¹åº”çš„å¸½å­åˆ—è¡¨
local function getFlingParts()
    local parts = {}
    if Reanim.SelectedMethod == "All" then
        return Reanim.DeadParts
    elseif Reanim.SelectedMethod == "Biggest" then
        local biggest = nil
        local maxSize = 0
        for _, h in ipairs(Reanim.DeadParts) do
            if h and h.Parent then
                local s = h.Size.Magnitude
                if s > maxSize then
                    maxSize = s
                    biggest = h
                end
            end
        end
        if biggest then table.insert(parts, biggest) end
        return parts
    else -- "Tool"
        -- æ‰¾ç©å®¶æ‰‹ä¸­çš„å·¥å…· (ä½†æ­»äº¡åæ— è§’è‰²ï¼Œå¯æ”¹ä¸ºä¸Šæ¬¡ä½¿ç”¨çš„å·¥å…·ï¼Œè¿™é‡Œç®€å•è¿”å›ç©º)
        return {}
    end
end

-- å¼€å¯ç”©é£å¾ªç¯
local function startFling()
    if not Reanim.Active then StatusText.Text = "âš ï¸ è¯·å…ˆæ¿€æ´»æ­»äº¡æ¨¡å¼" return end
    if not Reanim.FlingTarget then StatusText.Text = "ğŸ¯ è¯·å…ˆé€‰æ‹©ç›®æ ‡" return end

    if Reanim.FlingConn then Reanim.FlingConn:Disconnect() end

    Reanim.FlingEnabled = true
    StatusText.Text = "ğŸš€ ç”©é£å·²å¯åŠ¨ -> "..Reanim.FlingTarget.Name

    Reanim.FlingConn = RunService.Heartbeat:Connect(function(dt)
        if not Reanim.FlingTarget or not Reanim.FlingTarget.Parent then
            StatusText.Text = "âŒ ç›®æ ‡æ¶ˆå¤±ï¼Œåœæ­¢ç”©é£"
            Reanim.FlingEnabled = false
            Reanim.FlingConn:Disconnect()
            Reanim.FlingConn = nil
            return
        end

        -- é¢„æµ‹ç›®æ ‡ä½ç½®ï¼ˆç®€å•é¢„æµ‹ï¼‰
        local targetPos = Reanim.FlingTarget.Position
        local targetVel = Reanim.FlingTarget.AssemblyLinearVelocity
        local futurePos = targetPos + targetVel * 0.3  -- é¢„æµ‹0.3ç§’å

        local parts = getFlingParts()
        for _, handle in ipairs(parts) do
            if handle and handle.Parent then
                local dir = (futurePos - handle.Position).Unit
                local targetCF = CFrame.lookAt(handle.Position, handle.Position + dir) * CFrame.new(0,0,-3)
                SetUACFrameNetless(handle, dt, targetCF, Vector3.new(), true)  -- æ—‹è½¬
            end
        end
    end)
end

-- åœæ­¢æ‰€æœ‰
local function stopAll()
    if Reanim.FlingConn then
        Reanim.FlingConn:Disconnect()
        Reanim.FlingConn = nil
    end
    Reanim.FlingEnabled = false
    Reanim.CollideEnabled = false
    StatusText.Text = "â¹ï¸ å·²åœæ­¢"
end

-- ==================== ç»‘å®šæŒ‰é’®äº‹ä»¶ ====================
btn1.MouseButton1Click:Connect(activateDeath)
btn2.MouseButton1Click:Connect(enableCollide)
btn3.MouseButton1Click:Connect(startFling)
btn4.MouseButton1Click:Connect(switchMethod)
btn5.MouseButton1Click:Connect(selectTarget)
btn6.MouseButton1Click:Connect(stopAll)

-- åˆå§‹çŠ¶æ€
MethodLabel.Text = "å½“å‰ç”©é£æ–¹æ³•: All"
StatusText.Text = "â›” æœªæ¿€æ´»"

-- ==================== æ¸…ç†å‡½æ•° ====================
LocalPlayer.CharacterAdded:Connect(function()  -- å¦‚æœé‡ç”Ÿï¼Œé‡ç½®çŠ¶æ€
    Reanim.Active = false
    Reanim.DeadParts = {}
    Reanim.FlingTarget = nil
    if Reanim.FlingConn then Reanim.FlingConn:Disconnect() end
    StatusText.Text = "â›” æœªæ¿€æ´»"
end)

-- æç¤º
print("Uhhhhhh Reanimate GUI å·²åŠ è½½ï¼ä½¿ç”¨UIæ§åˆ¶æ°¸ä¹…æ­»äº¡å’Œå¸½å­æŠ€èƒ½ã€‚")
