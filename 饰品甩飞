-- Uhhhhhh Reanimate - PhysicsRepRootPart ç”©é£ç³»ç»Ÿ
-- ç°ä»£åŒ–UIç•Œé¢ | å¯æ‹–åŠ¨ | å¯ç¼©æ”¾ | åŠ¨ç”»æ•ˆæœ | ç±»ä¼¼SigmaSpyé£æ ¼
-- ä»…ä¾›æ•™è‚²ç ”ç©¶ç›®çš„

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- ========== é…ç½®ç³»ç»Ÿ ==========
local Settings = {
    FlingPower = 16384,
    FlingHeight = 5,
    TargetDistance = 50,
    UsePrediction = true,
    PredictionTime = 0.2,
    RotationSpeed = 500,
    AutoTarget = true,
    TargetSpecificPlayer = "",
    UseHatFling = false,
    Cooldown = 1,
    UIScale = 1,
    Theme = "Dark", -- Dark, Purple, Blue, Red
    AnimationSpeed = 0.3,
    AutoClose = true,
}

-- ========== UIç®¡ç†å™¨ ==========
local UIManager = {
    MainScreenGui = nil,
    Dragging = false,
    DragStartPos = nil,
    UIStartPos = nil,
    IsScaling = false,
    ScaleStartPos = nil,
    OriginalSize = nil,
    Elements = {},
    ActiveTweens = {},
}

-- ========== åŠ¨ç”»æ•ˆæœåº“ ==========
local Animations = {
    -- ç¼“åŠ¨å‡½æ•°
    EasingStyles = {
        Linear = Enum.EasingStyle.Linear,
        Quad = Enum.EasingStyle.Quad,
        Cubic = Enum.EasingStyle.Cubic,
        Quart = Enum.EasingStyle.Quart,
        Quint = Enum.EasingStyle.Quint,
        Sine = Enum.EasingStyle.Sine,
        Expo = Enum.EasingStyle.Exponential,
        Circ = Enum.EasingStyle.Circular,
        Elastic = Enum.EasingStyle.Elastic,
        Back = Enum.EasingStyle.Back,
        Bounce = Enum.EasingStyle.Bounce
    },
    
    -- ç¼“åŠ¨æ–¹å‘
    EasingDirections = {
        In = Enum.EasingDirection.In,
        Out = Enum.EasingDirection.Out,
        InOut = Enum.EasingDirection.InOut
    },
    
    -- åˆ›å»ºåŠ¨ç”»
    CreateTween = function(object, properties, duration, easingStyle, easingDirection)
        local tweenInfo = TweenInfo.new(
            duration or 0.3,
            easingStyle or Enum.EasingStyle.Quad,
            easingDirection or Enum.EasingDirection.Out,
            0,
            false,
            0
        )
        local tween = TweenService:Create(object, tweenInfo, properties)
        return tween
    end,
    
    -- æŒ‰é’®æ‚¬åœæ•ˆæœ
    ButtonHover = function(button, isHovering)
        if not button then return end
        
        local targetColor
        if isHovering then
            targetColor = Color3.fromRGB(80, 80, 80)
        else
            targetColor = Color3.fromRGB(60, 60, 60)
        end
        
        Animations.CreateTween(button, {BackgroundColor3 = targetColor}, 0.15):Play()
    end,
    
    -- æŒ‰é’®ç‚¹å‡»æ•ˆæœ
    ButtonClick = function(button)
        if not button then return end
        
        local originalColor = button.BackgroundColor3
        local originalSize = button.Size
        
        Animations.CreateTween(button, {BackgroundColor3 = Color3.fromRGB(100, 100, 100)}, 0.1):Play()
        Animations.CreateTween(button, {Size = originalSize * UDim2.new(0.95, 0, 0.95, 0)}, 0.1):Play()
        
        task.delay(0.1, function()
            Animations.CreateTween(button, {BackgroundColor3 = originalColor}, 0.1):Play()
            Animations.CreateTween(button, {Size = originalSize}, 0.1):Play()
        end)
    end,
    
    -- å¼€å…³åˆ‡æ¢åŠ¨ç”»
    ToggleSwitch = function(toggleButton, isOn)
        local targetColor
        local targetPosition
        
        if isOn then
            targetColor = Color3.fromRGB(0, 170, 255)
            targetPosition = UDim2.new(0.7, 0, 0.15, 0)
        else
            targetColor = Color3.fromRGB(100, 100, 100)
            targetPosition = UDim2.new(0.1, 0, 0.15, 0)
        end
        
        Animations.CreateTween(toggleButton, {BackgroundColor3 = targetColor}, 0.2):Play()
        Animations.CreateTween(toggleButton, {Position = targetPosition}, 0.2):Play()
    end,
    
    -- é¡µé¢åˆ‡æ¢åŠ¨ç”»
    PageTransition = function(oldPage, newPage)
        if oldPage then
            Animations.CreateTween(oldPage, {Position = UDim2.new(-1, 0, 0, 0)}, 0.3):Play()
        end
        
        newPage.Position = UDim2.new(1, 0, 0, 0)
        Animations.CreateTween(newPage, {Position = UDim2.new(0, 0, 0, 0)}, 0.3):Play()
    end,
    
    -- æ•°å€¼æ»‘å—åŠ¨ç”»
    SliderFill = function(fill, value)
        Animations.CreateTween(fill, {Size = UDim2.new(value, 0, 1, 0)}, 0.2):Play()
    end,
    
    -- é€šçŸ¥åŠ¨ç”»
    Notification = function(frame)
        frame.Position = UDim2.new(0.5, 0, -1, 0)
        frame.Visible = true
        
        Animations.CreateTween(frame, {Position = UDim2.new(0.5, 0, 0.05, 0)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out):Play()
        
        task.delay(3, function()
            Animations.CreateTween(frame, {Position = UDim2.new(0.5, 0, -1, 0)}, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In):Play()
            task.delay(0.5, function()
                frame.Visible = false
            end)
        end)
    end
}

-- ========== å·¥å…·å‡½æ•° ==========
local Utils = {}

-- é¢„æµ‹ç®—æ³•
function Utils.PredictPosition(targetPart, timeOffset)
    if not targetPart or not targetPart:IsDescendantOf(Workspace) then
        return targetPart and targetPart.Position or Vector3.new()
    end
    
    local currentPos = targetPart.Position
    local velocity = targetPart.AssemblyLinearVelocity or Vector3.new()
    local gravity = Workspace.Gravity
    
    -- åŸºç¡€é¢„æµ‹
    local predictedPos = currentPos + velocity * timeOffset
    predictedPos = predictedPos + Vector3.new(0, -gravity * 0.5 * timeOffset * timeOffset, 0)
    
    -- éšæœºæ‰°åŠ¨
    local randomOffset = Vector3.new(
        math.random(-10, 10) * 0.01,
        math.random(-5, 5) * 0.01,
        math.random(-10, 10) * 0.01
    )
    
    return predictedPos + randomOffset
end

-- è·å–æœ€è¿‘ç©å®¶
function Utils.GetNearestPlayer(maxDistance)
    local nearestPlayer = nil
    local nearestDistance = maxDistance or Settings.TargetDistance
    local localRoot = Character:FindFirstChild("HumanoidRootPart")
    
    if not localRoot then return nil end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
            if targetRoot then
                local distance = (localRoot.Position - targetRoot.Position).Magnitude
                if distance < nearestDistance then
                    nearestDistance = distance
                    nearestPlayer = player
                end
            end
        end
    end
    
    return nearestPlayer
end

-- è·å–æŒ‡å®šç©å®¶
function Utils.GetSpecificPlayer(name)
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name:lower():find(name:lower()) then
            return player
        end
    end
    return nil
end

-- ç”ŸæˆéšæœºID
function Utils.GenerateID(length)
    local characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
    local result = ""
    
    for i = 1, length or 8 do
        local randomIndex = math.random(1, #characters)
        result = result .. string.sub(characters, randomIndex, randomIndex)
    end
    
    return result
end

-- ========== ç”©é£ç³»ç»Ÿ ==========
local PhysicsFling = {
    RootPart = nil,
    Humanoid = nil,
    HatHandle = nil,
    LastFlingTime = 0,
    IsActive = false,
    Connection = nil
}

function PhysicsFling:Initialize()
    self.RootPart = Character:WaitForChild("HumanoidRootPart")
    self.Humanoid = Character:WaitForChild("Humanoid")
    self.LastFlingTime = 0
    
    if Settings.UseHatFling and Character:FindFirstChildOfClass("Accessory") then
        self.HatHandle = Character:FindFirstChildOfClass("Accessory").Handle
    else
        self.HatHandle = nil
    end
end

function PhysicsFling:ExecuteFling(targetPlayer)
    if tick() - self.LastFlingTime < Settings.Cooldown then
        return
    end
    
    if not targetPlayer or not targetPlayer.Character then
        UIManager:ShowNotification("æ— æ•ˆç›®æ ‡")
        return
    end
    
    local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not targetRoot then
        UIManager:ShowNotification("ç›®æ ‡æ²¡æœ‰HumanoidRootPart")
        return
    end
    
    -- è®¡ç®—é¢„æµ‹ä½ç½®
    local targetPosition = targetRoot.Position
    if Settings.UsePrediction then
        targetPosition = Utils.PredictPosition(targetRoot, Settings.PredictionTime)
    end
    
    -- è®¡ç®—ç”©é£çš„CFrame
    local flingCFrame = CFrame.new(
        targetPosition + Vector3.new(0, Settings.FlingHeight, 0)
    ) * CFrame.Angles(
        math.rad(math.random(0, 360)),
        math.rad(math.random(0, 360)),
        math.rad(math.random(0, 360))
    )
    
    -- è®¡ç®—ç”©é£é€Ÿåº¦
    local flingVelocity = Vector3.new(
        math.random(-100, 100),
        -Settings.FlingPower,
        math.random(-100, 100)
    )
    
    local flingRotVelocity = Vector3.new(
        Settings.RotationSpeed,
        Settings.RotationSpeed,
        Settings.RotationSpeed
    )
    
    -- æ‰§è¡Œç”©é£
    local success, err = pcall(function()
        if Settings.UseHatFling and self.HatHandle then
            -- å¸½å­æ¨¡å¼
            self.HatHandle:SetAttribute("PhysicsRepRootPart", targetRoot)
            self.HatHandle.AssemblyLinearVelocity = flingVelocity
            self.HatHandle.AssemblyAngularVelocity = flingRotVelocity
            self.HatHandle.CFrame = flingCFrame
        else
            -- è‚¢ä½“æ¨¡å¼
            self.RootPart:SetAttribute("PhysicsRepRootPart", targetRoot)
            self.RootPart.CFrame = flingCFrame
            self.RootPart.Velocity = flingVelocity
            self.RootPart.RotVelocity = flingRotVelocity
        end
    end)
    
    if success then
        UIManager:ShowNotification("ç”©é£æˆåŠŸ: " .. targetPlayer.Name)
        self.LastFlingTime = tick()
    else
        UIManager:ShowNotification("ç”©é£å¤±è´¥: " .. err)
    end
    
    -- æ¸…ç†
    task.delay(0.1, function()
        pcall(function()
            if Settings.UseHatFling and self.HatHandle then
                self.HatHandle:SetAttribute("PhysicsRepRootPart", nil)
            else
                self.RootPart:SetAttribute("PhysicsRepRootPart", nil)
            end
        end)
    end)
end

function PhysicsFling:StartAutoFling()
    if self.IsActive then return end
    
    self.IsActive = true
    self.Connection = RunService.Heartbeat:Connect(function()
        local target = nil
        
        if Settings.TargetSpecificPlayer ~= "" then
            target = Utils.GetSpecificPlayer(Settings.TargetSpecificPlayer)
        elseif Settings.AutoTarget then
            target = Utils.GetNearestPlayer()
        end
        
        if target then
            self:ExecuteFling(target)
        end
    end)
    
    UIManager:ShowNotification("è‡ªåŠ¨ç”©é£å·²å¯åŠ¨")
end

function PhysicsFling:Stop()
    self.IsActive = false
    if self.Connection then
        self.Connection:Disconnect()
        self.Connection = nil
    end
    
    pcall(function()
        if self.RootPart then
            self.RootPart:SetAttribute("PhysicsRepRootPart", nil)
        end
        if self.HatHandle then
            self.HatHandle:SetAttribute("PhysicsRepRootPart", nil)
        end
    end)
    
    UIManager:ShowNotification("è‡ªåŠ¨ç”©é£å·²åœæ­¢")
end

-- ========== UIåˆ›å»ºå™¨ ==========
function UIManager:CreateModernUI()
    -- æ¸…ç†ç°æœ‰UI
    if self.MainScreenGui then
        self.MainScreenGui:Destroy()
    end
    
    -- åˆ›å»ºä¸»GUI
    self.MainScreenGui = Instance.new("ScreenGui")
    self.MainScreenGui.Name = "SigmaFlingUI_" .. Utils.GenerateID(8)
    self.MainScreenGui.ResetOnSpawn = false
    self.MainScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.MainScreenGui.Parent = game.CoreGui
    
    -- ä¸»é¢˜é¢œè‰²
    local ThemeColors = {
        Dark = {
            Primary = Color3.fromRGB(25, 25, 25),
            Secondary = Color3.fromRGB(40, 40, 40),
            Accent = Color3.fromRGB(0, 170, 255),
            Text = Color3.fromRGB(240, 240, 240),
            Border = Color3.fromRGB(60, 60, 60)
        },
        Purple = {
            Primary = Color3.fromRGB(30, 20, 40),
            Secondary = Color3.fromRGB(50, 35, 70),
            Accent = Color3.fromRGB(180, 80, 255),
            Text = Color3.fromRGB(240, 240, 240),
            Border = Color3.fromRGB(80, 60, 100)
        },
        Blue = {
            Primary = Color3.fromRGB(20, 25, 45),
            Secondary = Color3.fromRGB(35, 45, 75),
            Accent = Color3.fromRGB(100, 180, 255),
            Text = Color3.fromRGB(240, 240, 240),
            Border = Color3.fromRGB(60, 80, 120)
        },
        Red = {
            Primary = Color3.fromRGB(40, 20, 20),
            Secondary = Color3.fromRGB(70, 35, 35),
            Accent = Color3.fromRGB(255, 80, 80),
            Text = Color3.fromRGB(240, 240, 240),
            Border = Color3.fromRGB(100, 60, 60)
        }
    }
    
    local CurrentTheme = ThemeColors[Settings.Theme] or ThemeColors.Dark
    
    -- ä¸»çª—å£
    local MainWindow = Instance.new("Frame")
    MainWindow.Name = "MainWindow"
    MainWindow.Size = UDim2.new(0, 450, 0, 550)
    MainWindow.Position = UDim2.new(0.5, -225, 0.5, -275)
    MainWindow.BackgroundColor3 = CurrentTheme.Primary
    MainWindow.BorderSizePixel = 1
    MainWindow.BorderColor3 = CurrentTheme.Border
    MainWindow.ClipsDescendants = true
    MainWindow.Parent = self.MainScreenGui
    self.Elements.MainWindow = MainWindow
    
    -- çª—å£åœ†è§’
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = MainWindow
    
    -- æ ‡é¢˜æ 
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = CurrentTheme.Secondary
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainWindow
    self.Elements.TitleBar = TitleBar
    
    local TitleBarCorner = Instance.new("UICorner")
    TitleBarCorner.CornerRadius = UDim.new(0, 8, 0, 0)
    TitleBarCorner.Parent = TitleBar
    
    -- æ ‡é¢˜æ–‡å­—
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Size = UDim2.new(0, 200, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "Sigma Fling V2.0"
    TitleLabel.TextColor3 = CurrentTheme.Accent
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 20
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = TitleBar
    
    -- å‰¯æ ‡é¢˜
    local SubtitleLabel = Instance.new("TextLabel")
    SubtitleLabel.Name = "SubtitleLabel"
    SubtitleLabel.Size = UDim2.new(0, 200, 0, 15)
    SubtitleLabel.Position = UDim2.new(0, 15, 0, 25)
    SubtitleLabel.BackgroundTransparency = 1
    SubtitleLabel.Text = "PhysicsRepRootPart System"
    SubtitleLabel.TextColor3 = CurrentTheme.Text
    SubtitleLabel.Font = Enum.Font.Gotham
    SubtitleLabel.TextSize = 12
    SubtitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    SubtitleLabel.TextTransparency = 0.5
    SubtitleLabel.Parent = TitleBar
    
    -- æ§åˆ¶æŒ‰é’®
    local ControlButtons = {
        {Name = "Minimize", Icon = "_"},
        {Name = "Maximize", Icon = "â–¡"},
        {Name = "Close", Icon = "X"}
    }
    
    for i, buttonInfo in ipairs(ControlButtons) do
        local ControlButton = Instance.new("TextButton")
        ControlButton.Name = buttonInfo.Name .. "Button"
        ControlButton.Size = UDim2.new(0, 30, 0, 30)
        ControlButton.Position = UDim2.new(1, -40 * (4 - i), 0.5, -15)
        ControlButton.BackgroundColor3 = CurrentTheme.Primary
        ControlButton.Text = buttonInfo.Icon
        ControlButton.TextColor3 = CurrentTheme.Text
        ControlButton.Font = Enum.Font.GothamBold
        ControlButton.TextSize = 14
        ControlButton.BorderSizePixel = 0
        ControlButton.Parent = TitleBar
        
        local ButtonCorner = Instance.new("UICorner")
        ButtonCorner.CornerRadius = UDim.new(0, 4)
        ButtonCorner.Parent = ControlButton
        
        ControlButton.MouseEnter:Connect(function()
            Animations.ButtonHover(ControlButton, true)
        end)
        
        ControlButton.MouseLeave:Connect(function()
            Animations.ButtonHover(ControlButton, false)
        end)
        
        ControlButton.MouseButton1Click:Connect(function()
            Animations.ButtonClick(ControlButton)
            
            if buttonInfo.Name == "Close" then
                self:ToggleUI()
            elseif buttonInfo.Name == "Minimize" then
                self:ToggleMinimize()
            end
        end)
    end
    
    -- æ ‡ç­¾æ 
    local TabContainer = Instance.new("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.Size = UDim2.new(1, 0, 0, 50)
    TabContainer.Position = UDim2.new(0, 0, 0, 40)
    TabContainer.BackgroundColor3 = CurrentTheme.Primary
    TabContainer.BorderSizePixel = 0
    TabContainer.Parent = MainWindow
    self.Elements.TabContainer = TabContainer
    
    -- æ ‡ç­¾æŒ‰é’®
    local Tabs = {
        {Name = "Main", Icon = "âš¡"},
        {Name = "Settings", Icon = "âš™ï¸"},
        {Name = "Visual", Icon = "ğŸ¨"},
        {Name = "Players", Icon = "ğŸ‘¤"},
        {Name = "Credits", Icon = "ğŸ’"}
    }
    
    local TabButtons = {}
    for i, tab in ipairs(Tabs) do
        local TabButton = Instance.new("TextButton")
        TabButton.Name = tab.Name .. "Tab"
        TabButton.Size = UDim2.new(1 / #Tabs, 0, 1, 0)
        TabButton.Position = UDim2.new((i - 1) / #Tabs, 0, 0, 0)
        TabButton.BackgroundColor3 = CurrentTheme.Primary
        TabButton.Text = tab.Icon .. " " .. tab.Name
        TabButton.TextColor3 = CurrentTheme.Text
        TabButton.Font = Enum.Font.Gotham
        TabButton.TextSize = 12
        TabButton.BorderSizePixel = 0
        TabButton.Parent = TabContainer
        
        local TabUnderline = Instance.new("Frame")
        TabUnderline.Name = "Underline"
        TabUnderline.Size = UDim2.new(1, 0, 0, 3)
        TabUnderline.Position = UDim2.new(0, 0, 1, -3)
        TabUnderline.BackgroundColor3 = CurrentTheme.Accent
        TabUnderline.BorderSizePixel = 0
        TabUnderline.Visible = i == 1
        TabUnderline.Parent = TabButton
        
        TabButton.MouseEnter:Connect(function()
            if not TabUnderline.Visible then
                Animations.CreateTween(TabButton, {BackgroundColor3 = CurrentTheme.Secondary}, 0.2):Play()
            end
        end)
        
        TabButton.MouseLeave:Connect(function()
            if not TabUnderline.Visible then
                Animations.CreateTween(TabButton, {BackgroundColor3 = CurrentTheme.Primary}, 0.2):Play()
            end
        end)
        
        TabButton.MouseButton1Click:Connect(function()
            self:SwitchTab(tab.Name)
            for _, btn in pairs(TabButtons) do
                btn.Underline.Visible = false
                Animations.CreateTween(btn, {BackgroundColor3 = CurrentTheme.Primary}, 0.2):Play()
            end
            TabUnderline.Visible = true
            Animations.CreateTween(TabButton, {BackgroundColor3 = CurrentTheme.Secondary}, 0.2):Play()
        end)
        
        TabButtons[tab.Name] = TabButton
    end
    
    -- é¡µé¢å®¹å™¨
    local PagesContainer = Instance.new("Frame")
    PagesContainer.Name = "PagesContainer"
    PagesContainer.Size = UDim2.new(1, -20, 1, -110)
    PagesContainer.Position = UDim2.new(0, 10, 0, 90)
    PagesContainer.BackgroundTransparency = 1
    PagesContainer.ClipsDescendants = true
    PagesContainer.Parent = MainWindow
    self.Elements.PagesContainer = PagesContainer
    
    -- åˆ›å»ºé¡µé¢
    self:CreateMainPage(PagesContainer, CurrentTheme)
    self:CreateSettingsPage(PagesContainer, CurrentTheme)
    self:CreateVisualPage(PagesContainer, CurrentTheme)
    self:CreatePlayersPage(PagesContainer, CurrentTheme)
    self:CreateCreditsPage(PagesContainer, CurrentTheme)
    
    -- é€šçŸ¥ç³»ç»Ÿ
    local NotificationFrame = Instance.new("Frame")
    NotificationFrame.Name = "Notification"
    NotificationFrame.Size = UDim2.new(0.8, 0, 0, 40)
    NotificationFrame.Position = UDim2.new(0.5, 0, -1, 0)
    NotificationFrame.AnchorPoint = Vector2.new(0.5, 0)
    NotificationFrame.BackgroundColor3 = CurrentTheme.Secondary
    NotificationFrame.BorderSizePixel = 0
    NotificationFrame.Visible = false
    NotificationFrame.Parent = self.MainScreenGui
    
    local NotificationCorner = Instance.new("UICorner")
    NotificationCorner.CornerRadius = UDim.new(0, 8)
    NotificationCorner.Parent = NotificationFrame
    
    local NotificationLabel = Instance.new("TextLabel")
    NotificationLabel.Size = UDim2.new(1, -20, 1, 0)
    NotificationLabel.Position = UDim2.new(0, 10, 0, 0)
    NotificationLabel.BackgroundTransparency = 1
    NotificationLabel.Text = ""
    NotificationLabel.TextColor3 = CurrentTheme.Text
    NotificationLabel.Font = Enum.Font.Gotham
    NotificationLabel.TextSize = 14
    NotificationLabel.TextXAlignment = Enum.TextXAlignment.Left
    NotificationLabel.Parent = NotificationFrame
    
    self.Elements.NotificationFrame = NotificationFrame
    self.Elements.NotificationLabel = NotificationLabel
    
    -- è®¾ç½®æ‹–åŠ¨åŠŸèƒ½
    self:SetupDragAndScale(TitleBar, MainWindow)
    
    -- æ˜¾ç¤ºUI
    self:ShowUI()
end

function UIManager:CreateMainPage(parent, theme)
    local MainPage = Instance.new("Frame")
    MainPage.Name = "MainPage"
    MainPage.Size = UDim2.new(1, 0, 1, 0)
    MainPage.BackgroundTransparency = 1
    MainPage.Visible = true
    MainPage.Parent = parent
    self.Elements.MainPage = MainPage
    
    -- å¤§æŒ‰é’®å®¹å™¨
    local ButtonGrid = Instance.new("Frame")
    ButtonGrid.Name = "ButtonGrid"
    ButtonGrid.Size = UDim2.new(1, 0, 0, 200)
    ButtonGrid.Position = UDim2.new(0, 0, 0, 10)
    ButtonGrid.BackgroundTransparency = 1
    ButtonGrid.Parent = MainPage
    
    -- å¤§æŒ‰é’®
    local BigButtons = {
        {Name = "Start Auto", Icon = "â–¶ï¸", Color = Color3.fromRGB(0, 200, 100)},
        {Name = "Stop Auto", Icon = "â¹ï¸", Color = Color3.fromRGB(200, 0, 50)},
        {Name = "Fling Nearest", Icon = "âš¡", Color = theme.Accent},
        {Name = "Emergency Stop", Icon = "ğŸ›‘", Color = Color3.fromRGB(255, 100, 0)}
    }
    
    for i = 1, 4 do
        local row = math.ceil(i / 2)
        local col = (i - 1) % 2
        
        local BigButton = Instance.new("TextButton")
        BigButton.Name = BigButtons[i].Name
        BigButton.Size = UDim2.new(0.48, 0, 0, 90)
        BigButton.Position = UDim2.new(col * 0.5, 10, 0, (row - 1) * 100 + 10)
        BigButton.BackgroundColor3 = BigButtons[i].Color
        BigButton.Text = BigButtons[i].Icon .. "\n" .. BigButtons[i].Name
        BigButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        BigButton.Font = Enum.Font.GothamBold
        BigButton.TextSize = 16
        BigButton.TextWrapped = true
        BigButton.BorderSizePixel = 0
        BigButton.Parent = ButtonGrid
        
        local ButtonCorner = Instance.new("UICorner")
        ButtonCorner.CornerRadius = UDim.new(0, 12)
        ButtonCorner.Parent = BigButton
        
        -- æŒ‰é’®æ•ˆæœ
        BigButton.MouseEnter:Connect(function()
            Animations.CreateTween(BigButton, {Size = BigButton.Size * UDim2.new(1.05, 0, 1.05, 0)}, 0.2):Play()
        end)
        
        BigButton.MouseLeave:Connect(function()
            Animations.CreateTween(BigButton, {Size = UDim2.new(0.48, 0, 0, 90)}, 0.2):Play()
        end)
        
        BigButton.MouseButton1Click:Connect(function()
            Animations.ButtonClick(BigButton)
            
            if BigButtons[i].Name == "Start Auto" then
                PhysicsFling:StartAutoFling()
            elseif BigButtons[i].Name == "Stop Auto" then
                PhysicsFling:Stop()
            elseif BigButtons[i].Name == "Fling Nearest" then
                local target = Utils.GetNearestPlayer()
                if target then
                    PhysicsFling:ExecuteFling(target)
                else
                    self:ShowNotification("é™„è¿‘æ²¡æœ‰ç©å®¶")
                end
            elseif BigButtons[i].Name == "Emergency Stop" then
                PhysicsFling:Stop()
                self:ShowNotification("ç´§æ€¥åœæ­¢")
            end
        end)
    end
    
    -- çŠ¶æ€æ˜¾ç¤º
    local StatusFrame = Instance.new("Frame")
    StatusFrame.Name = "StatusFrame"
    StatusFrame.Size = UDim2.new(1, 0, 0, 120)
    StatusFrame.Position = UDim2.new(0, 0, 0, 220)
    StatusFrame.BackgroundColor3 = theme.Secondary
    StatusFrame.BorderSizePixel = 0
    StatusFrame.Parent = MainPage
    
    local StatusCorner = Instance.new("UICorner")
    StatusCorner.CornerRadius = UDim.new(0, 8)
    StatusCorner.Parent = StatusFrame
    
    local StatusTitle = Instance.new("TextLabel")
    StatusTitle.Size = UDim2.new(1, -20, 0, 30)
    StatusTitle.Position = UDim2.new(0, 10, 0, 10)
    StatusTitle.BackgroundTransparency = 1
    StatusTitle.Text = "ğŸ“Š ç³»ç»ŸçŠ¶æ€"
    StatusTitle.TextColor3 = theme.Accent
    StatusTitle.Font = Enum.Font.GothamBold
    StatusTitle.TextSize = 18
    StatusTitle.TextXAlignment = Enum.TextXAlignment.Left
    StatusTitle.Parent = StatusFrame
    
    -- çŠ¶æ€é¡¹ç›®
    local StatusItems = {
        {Name = "Auto Fling", Key = "AutoTarget"},
        {Name = "Prediction", Key = "UsePrediction"},
        {Name = "Hat Mode", Key = "UseHatFling"},
        {Name = "Target Lock", Key = "TargetSpecificPlayer"}
    }
    
    for i, item in ipairs(StatusItems) do
        local StatusItem = Instance.new("TextLabel")
        StatusItem.Size = UDim2.new(0.45, 0, 0, 20)
        StatusItem.Position = UDim2.new((i - 1) % 2 * 0.5, 10, math.floor((i - 1) / 2) * 0.25 + 0.3, 0)
        StatusItem.BackgroundTransparency = 1
        StatusItem.Text = item.Name .. ":"
        StatusItem.TextColor3 = theme.Text
        StatusItem.Font = Enum.Font.Gotham
        StatusItem.TextSize = 12
        StatusItem.TextXAlignment = Enum.TextXAlignment.Left
        StatusItem.Parent = StatusFrame
        
        local StatusValue = Instance.new("TextLabel")
        StatusValue.Size = UDim2.new(0.45, 0, 0, 20)
        StatusValue.Position = UDim2.new((i - 1) % 2 * 0.5 + 0.45, 10, math.floor((i - 1) / 2) * 0.25 + 0.3, 0)
        StatusValue.BackgroundTransparency = 1
        StatusValue.Text = Settings[item.Key] and (item.Key == "TargetSpecificPlayer" and (Settings[item.Key] ~= "" and Settings[item.Key] or "None") or "ON") or "OFF"
        StatusValue.TextColor3 = Settings[item.Key] and theme.Accent or Color3.fromRGB(255, 100, 100)
        StatusValue.Font = Enum.Font.GothamBold
        StatusValue.TextSize = 12
        StatusValue.TextXAlignment = Enum.TextXAlignment.Right
        StatusValue.Parent = StatusFrame
    end
end

function UIManager:CreateSettingsPage(parent, theme)
    -- è®¾ç½®é¡µé¢ï¼ˆé™äºç¯‡å¹…ï¼Œè¿™é‡Œåªåˆ›å»ºæ¡†æ¶ï¼‰
    local SettingsPage = Instance.new("Frame")
    SettingsPage.Name = "SettingsPage"
    SettingsPage.Size = UDim2.new(1, 0, 1, 0)
    SettingsPage.BackgroundTransparency = 1
    SettingsPage.Visible = false
    SettingsPage.Parent = parent
    
    -- æ·»åŠ è®¾ç½®é¡¹...
end

function UIManager:CreateVisualPage(parent, theme)
    -- è§†è§‰é¡µé¢...
end

function UIManager:CreatePlayersPage(parent, theme)
    -- ç©å®¶é¡µé¢...
end

function UIManager:CreateCreditsPage(parent, theme)
    -- å…³äºé¡µé¢...
end

function UIManager:SetupDragAndScale(dragBar, window)
    -- æ‹–åŠ¨åŠŸèƒ½
    dragBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.Dragging = true
            self.DragStartPos = input.Position
            self.UIStartPos = window.Position
        end
    end)
    
    dragBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and self.Dragging then
            local delta = input.Position - self.DragStartPos
            window.Position = UDim2.new(
                self.UIStartPos.X.Scale,
                self.UIStartPos.X.Offset + delta.X,
                self.UIStartPos.Y.Scale,
                self.UIStartPos.Y.Offset + delta.Y
            )
        end
    end)
    
    dragBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.Dragging = false
        end
    end)
    
    -- ç¼©æ”¾åŠŸèƒ½
    local resizeHandle = Instance.new("Frame")
    resizeHandle.Name = "ResizeHandle"
    resizeHandle.Size = UDim2.new(0, 20, 0, 20)
    resizeHandle.Position = UDim2.new(1, -20, 1, -20)
    resizeHandle.BackgroundColor3 = theme.Accent
    resizeHandle.BorderSizePixel = 0
    resizeHandle.Parent = window
    
    local resizeCorner = Instance.new("UICorner")
    resizeCorner.CornerRadius = UDim.new(0, 4)
    resizeCorner.Parent = resizeHandle
    
    resizeHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.IsScaling = true
            self.ScaleStartPos = input.Position
            self.OriginalSize = window.Size
        end
    end)
    
    resizeHandle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and self.IsScaling then
            local delta = input.Position - self.ScaleStartPos
            local newWidth = math.clamp(self.OriginalSize.Width.Offset + delta.X, 300, 800)
            local newHeight = math.clamp(self.OriginalSize.Height.Offset + delta.Y, 400, 600)
            
            window.Size = UDim2.new(0, newWidth, 0, newHeight)
        end
    end)
    
    resizeHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            self.IsScaling = false
        end
    end)
end

function UIManager:SwitchTab(tabName)
    for _, page in pairs(self.Elements.PagesContainer:GetChildren()) do
        page.Visible = page.Name == tabName .. "Page"
    end
end

function UIManager:ShowNotification(message)
    self.Elements.NotificationLabel.Text = message
    Animations.Notification(self.Elements.NotificationFrame)
end

function UIManager:ShowUI()
    if not self.MainScreenGui then
        self:CreateModernUI()
        return
    end
    
    self.MainScreenGui.Enabled = true
    self.Elements.MainWindow.Position = UDim2.new(0.5, -225, 0.5, -275)
    self.Elements.MainWindow.Visible = true
end

function UIManager:HideUI()
    if self.MainScreenGui then
        self.MainScreenGui.Enabled = false
    end
end

function UIManager:ToggleUI()
    if self.MainScreenGui and self.MainScreenGui.Enabled then
        self:HideUI()
        self:ShowNotification("UIå·²éšè— (æŒ‰Inserté”®æ˜¾ç¤º)")
    else
        self:ShowUI()
    end
end

function UIManager:ToggleMinimize()
    if self.Elements.MainWindow then
        local isMinimized = self.Elements.MainWindow.Size.Y.Scale == 0
        local targetSize = isMinimized and UDim2.new(0, 450, 0, 550) or UDim2.new(0, 450, 0, 50)
        Animations.CreateTween(self.Elements.MainWindow, {Size = targetSize}, 0.3):Play()
    end
end

-- ========== ä¸»ç¨‹åº ==========
local function Main()
    -- åˆå§‹åŒ–ç³»ç»Ÿ
    PhysicsFling:Initialize()
    UIManager:CreateModernUI()
    
    print("=== Sigma Fling V2.0 å·²åŠ è½½ ===")
    print("ä½œè€…: Kennylolez")
    print("UIè®¾è®¡: SigmaSpyé£æ ¼")
    print("è­¦å‘Š: ä»…ä¾›æ•™è‚²ç›®çš„ï¼")
    
    -- é”®ç›˜å¿«æ·é”®
    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed then
            if input.KeyCode == Enum.KeyCode.Insert then
                UIManager:ToggleUI()
            elseif input.KeyCode == Enum.KeyCode.End then
                PhysicsFling:Stop()
                if UIManager.MainScreenGui then
                    UIManager.MainScreenGui:Destroy()
                end
                print("è„šæœ¬å·²å¸è½½")
            elseif input.KeyCode == Enum.KeyCode.Home then
                local target = Utils.GetNearestPlayer()
                if target then
                    PhysicsFling:ExecuteFling(target)
                end
            end
        end
    end)
    
    -- è§’è‰²æ­»äº¡æ—¶æ¸…ç†
    Character.Humanoid.Died:Connect(function()
        PhysicsFling:Stop()
        UIManager:ShowNotification("è§’è‰²æ­»äº¡ï¼Œç³»ç»Ÿå·²åœæ­¢")
    end)
    
    -- è‡ªåŠ¨éšè—UIï¼ˆå¦‚æœè®¾ç½®å¼€å¯ï¼‰
    if Settings.AutoClose then
        task.delay(10, function()
            UIManager:ShowNotification("UIå°†åœ¨5ç§’åè‡ªåŠ¨éšè—...")
            task.delay(5, function()
                UIManager:HideUI()
            end)
        end)
    end
end

-- å¯åŠ¨ç¨‹åº
if Character then
    Main()
else
    LocalPlayer.CharacterAdded:Wait()
    Character = LocalPlayer.Character
    Main()
end

-- å¿«æ·é”®è¯´æ˜
print("å¿«æ·é”®:")
print("Insert - æ˜¾ç¤º/éšè—UI")
print("Home - ç”©é£æœ€è¿‘ç©å®¶")
print("End - å¸è½½è„šæœ¬")
