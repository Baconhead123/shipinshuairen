-- 培根执行器 - 客户端脚本执行器
-- 蓝色霓虹风格 UI (全屏修复版)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- 创建主界面
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BaconExecutor"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
else
    ScreenGui.Parent = game.CoreGui
end

-- 颜色配置（蓝色霓虹主题）
local colors = {
    primary = Color3.fromRGB(0, 170, 255),
    secondary = Color3.fromRGB(0, 100, 200),
    accent = Color3.fromRGB(0, 255, 255),
    dark = Color3.fromRGB(10, 20, 40),
    darker = Color3.fromRGB(5, 10, 25),
    text = Color3.fromRGB(220, 240, 255),
    error = Color3.fromRGB(255, 50, 100),
    success = Color3.fromRGB(0, 255, 150),
    background = Color3.fromRGB(5, 10, 20)
}

-- 创建全屏背景（真正全屏）
local background = Instance.new("Frame")
background.Name = "Background"
background.Size = UDim2.new(1, 0, 1, 0)
background.BackgroundColor3 = colors.background
background.BackgroundTransparency = 0.3
background.BorderSizePixel = 0
background.ZIndex = 1
background.Parent = ScreenGui

-- 创建主窗口（真正全屏）
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(1, -10, 1, -10) -- 稍微缩小一点，留出边缘
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = colors.dark
mainFrame.BackgroundTransparency = 0.05
mainFrame.BorderSizePixel = 0
mainFrame.ZIndex = 2
mainFrame.Parent = background

-- 圆角
local corner = Instance.new("UICorner")
corner.Name = "Corner"
corner.CornerRadius = UDim.new(0, 20)
corner.Parent = mainFrame

-- 霓虹边框效果
local borderGlow = Instance.new("UIStroke")
borderGlow.Name = "BorderGlow"
borderGlow.Color = colors.primary
borderGlow.Thickness = 4
borderGlow.Transparency = 0.1
borderGlow.Parent = mainFrame

-- 标题栏
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 45)
titleBar.BackgroundColor3 = colors.darker
titleBar.BackgroundTransparency = 0.1
titleBar.BorderSizePixel = 0
titleBar.ZIndex = 3
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 15)
titleCorner.Parent = titleBar

local titleGlow = Instance.new("UIStroke")
titleGlow.Color = colors.primary
titleGlow.Thickness = 2
titleGlow.Transparency = 0.3
titleGlow.Parent = titleBar

local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(0, 200, 1, 0)
titleText.Position = UDim2.new(0, 20, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "BACON EXECUTOR"
titleText.TextColor3 = colors.text
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 22
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- 标题栏装饰
local titleDecor = Instance.new("Frame")
titleDecor.Name = "TitleDecor"
titleDecor.Size = UDim2.new(0, 120, 0, 4)
titleDecor.Position = UDim2.new(0, 20, 1, -6)
titleDecor.BackgroundColor3 = colors.accent
titleDecor.BorderSizePixel = 0
titleDecor.ZIndex = 4
titleDecor.Parent = titleBar

local decorCorner = Instance.new("UICorner")
decorCorner.CornerRadius = UDim.new(0, 2)
decorCorner.Parent = titleDecor

-- 缩放按钮（改为X样式）
local scaleButton = Instance.new("TextButton")
scaleButton.Name = "ScaleButton"
scaleButton.Size = UDim2.new(0, 45, 0, 45)
scaleButton.Position = UDim2.new(1, -50, 0, 0)
scaleButton.BackgroundColor3 = colors.dark
scaleButton.BackgroundTransparency = 0.4
scaleButton.Text = "✕"
scaleButton.TextColor3 = colors.text
scaleButton.Font = Enum.Font.GothamBold
scaleButton.TextSize = 24
scaleButton.ZIndex = 5
scaleButton.Parent = titleBar

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 10)
buttonCorner.Parent = scaleButton

-- 创建选项卡容器
local tabContainer = Instance.new("Frame")
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(1, -40, 0, 45)
tabContainer.Position = UDim2.new(0, 20, 0, 60)
tabContainer.BackgroundTransparency = 1
tabContainer.ZIndex = 3
tabContainer.Parent = mainFrame

-- 选项卡按钮
local tabs = {
    {name = "执行器", id = "executor"},
    {name = "脚本中心", id = "scripts"},
    {name = "设置", id = "settings"}
}

local tabButtons = {}
local currentTab = "executor"

for i, tab in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tab.name .. "Tab"
    tabButton.Size = UDim2.new(0, 130, 1, 0)
    tabButton.Position = UDim2.new(0, (i-1) * 140, 0, 0)
    tabButton.BackgroundColor3 = colors.darker
    tabButton.BackgroundTransparency = (tab.id == currentTab) and 0.3 or 0.5
    tabButton.Text = tab.name
    tabButton.TextColor3 = colors.text
    tabButton.Font = Enum.Font.GothamBold
    tabButton.TextSize = 16
    tabButton.ZIndex = 4
    tabButton.Parent = tabContainer
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 10)
    tabCorner.Parent = tabButton
    
    local tabIndicator = Instance.new("Frame")
    tabIndicator.Name = "Indicator"
    tabIndicator.Size = UDim2.new(1, 0, 0, 4)
    tabIndicator.Position = UDim2.new(0, 0, 1, -4)
    tabIndicator.BackgroundColor3 = colors.primary
    tabIndicator.BorderSizePixel = 0
    tabIndicator.Visible = (tab.id == currentTab)
    tabIndicator.ZIndex = 5
    tabIndicator.Parent = tabButton
    
    local indicatorCorner = Instance.new("UICorner")
    indicatorCorner.CornerRadius = UDim.new(0, 2)
    indicatorCorner.Parent = tabIndicator
    
    tabButtons[tab.id] = {button = tabButton, indicator = tabIndicator}
end

-- 创建内容容器
local contentContainer = Instance.new("Frame")
contentContainer.Name = "ContentContainer"
contentContainer.Size = UDim2.new(1, -40, 1, -130)
contentContainer.Position = UDim2.new(0, 20, 0, 120)
contentContainer.BackgroundTransparency = 1
contentContainer.ZIndex = 3
contentContainer.Parent = mainFrame

-- 执行器选项卡内容
local executorContent = Instance.new("Frame")
executorContent.Name = "ExecutorContent"
executorContent.Size = UDim2.new(1, 0, 1, 0)
executorContent.BackgroundTransparency = 1
executorContent.Visible = true
executorContent.ZIndex = 4
executorContent.Parent = contentContainer

-- 脚本输入区域
local inputFrame = Instance.new("Frame")
inputFrame.Name = "InputFrame"
inputFrame.Size = UDim2.new(0.49, -10, 0.7, 0)
inputFrame.BackgroundColor3 = colors.darker
inputFrame.BackgroundTransparency = 0.2
inputFrame.BorderSizePixel = 0
inputFrame.ZIndex = 5
inputFrame.Parent = executorContent

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 15)
inputCorner.Parent = inputFrame

local inputGlow = Instance.new("UIStroke")
inputGlow.Color = colors.secondary
inputGlow.Thickness = 2
inputGlow.Transparency = 0.2
inputGlow.Parent = inputFrame

local inputTitle = Instance.new("TextLabel")
inputTitle.Name = "InputTitle"
inputTitle.Size = UDim2.new(1, 0, 0, 35)
inputTitle.BackgroundColor3 = colors.darker
inputTitle.BackgroundTransparency = 0.4
inputTitle.Text = "  脚本输入"
inputTitle.TextColor3 = colors.text
inputTitle.Font = Enum.Font.GothamBold
inputTitle.TextSize = 16
inputTitle.TextXAlignment = Enum.TextXAlignment.Left
inputTitle.ZIndex = 6
inputTitle.Parent = inputFrame

local titleCorner2 = Instance.new("UICorner")
titleCorner2.CornerRadius = UDim.new(0, 15)
titleCorner2.Parent = inputTitle

local scriptInput = Instance.new("ScrollingFrame")
scriptInput.Name = "ScriptInput"
scriptInput.Size = UDim2.new(1, -20, 1, -45)
scriptInput.Position = UDim2.new(0, 10, 0, 40)
scriptInput.BackgroundTransparency = 1
scriptInput.BorderSizePixel = 0
scriptInput.ScrollBarThickness = 8
scriptInput.ScrollBarImageColor3 = colors.primary
scriptInput.ZIndex = 6
scriptInput.Parent = inputFrame

local inputBox = Instance.new("TextBox")
inputBox.Name = "InputBox"
inputBox.Size = UDim2.new(1, 0, 0, 0)
inputBox.AutomaticSize = Enum.AutomaticSize.Y
inputBox.BackgroundTransparency = 1
inputBox.Text = "-- 在此处粘贴脚本代码\n-- 支持 loadstring 格式\n-- 例如：loadstring(game:HttpGet('https://example.com/script.lua'))()"
inputBox.TextColor3 = Color3.fromRGB(150, 180, 220)
inputBox.Font = Enum.Font.Code
inputBox.TextSize = 14
inputBox.TextXAlignment = Enum.TextXAlignment.Left
inputBox.TextYAlignment = Enum.TextYAlignment.Top
inputBox.TextWrapped = true
inputBox.ClearTextOnFocus = false
inputBox.MultiLine = true
inputBox.ZIndex = 7
inputBox.Parent = scriptInput

-- 输出区域
local outputFrame = Instance.new("Frame")
outputFrame.Name = "OutputFrame"
outputFrame.Size = UDim2.new(0.49, -10, 0.7, 0)
outputFrame.Position = UDim2.new(0.51, 10, 0, 0)
outputFrame.BackgroundColor3 = colors.darker
outputFrame.BackgroundTransparency = 0.2
outputFrame.BorderSizePixel = 0
outputFrame.ZIndex = 5
outputFrame.Parent = executorContent

local outputCorner = Instance.new("UICorner")
outputCorner.CornerRadius = UDim.new(0, 15)
outputCorner.Parent = outputFrame

local outputGlow = Instance.new("UIStroke")
outputGlow.Color = colors.accent
outputGlow.Thickness = 2
outputGlow.Transparency = 0.2
outputGlow.Parent = outputFrame

local outputTitle = Instance.new("TextLabel")
outputTitle.Name = "OutputTitle"
outputTitle.Size = UDim2.new(1, 0, 0, 35)
outputTitle.BackgroundColor3 = colors.darker
outputTitle.BackgroundTransparency = 0.4
outputTitle.Text = "  输出日志"
outputTitle.TextColor3 = colors.text
outputTitle.Font = Enum.Font.GothamBold
outputTitle.TextSize = 16
outputTitle.TextXAlignment = Enum.TextXAlignment.Left
outputTitle.ZIndex = 6
outputTitle.Parent = outputFrame

local outputContent = Instance.new("ScrollingFrame")
outputContent.Name = "OutputContent"
outputContent.Size = UDim2.new(1, -20, 1, -45)
outputContent.Position = UDim2.new(0, 10, 0, 40)
outputContent.BackgroundTransparency = 1
outputContent.BorderSizePixel = 0
outputContent.ScrollBarThickness = 8
outputContent.ScrollBarImageColor3 = colors.accent
outputContent.ZIndex = 6
outputContent.Parent = outputFrame

local outputText = Instance.new("TextLabel")
outputText.Name = "OutputText"
outputText.Size = UDim2.new(1, 0, 0, 0)
outputText.AutomaticSize = Enum.AutomaticSize.Y
outputText.BackgroundTransparency = 1
outputText.Text = ">> 培根执行器已加载\n>> 欢迎使用 Bacon Executor"
outputText.TextColor3 = colors.text
outputText.Font = Enum.Font.Code
outputText.TextSize = 13
outputText.TextXAlignment = Enum.TextXAlignment.Left
outputText.TextYAlignment = Enum.TextYAlignment.Top
outputText.TextWrapped = true
outputText.ZIndex = 7
outputText.Parent = outputContent

-- 按钮区域
local buttonFrame = Instance.new("Frame")
buttonFrame.Name = "ButtonFrame"
buttonFrame.Size = UDim2.new(1, 0, 0.28, -10)
buttonFrame.Position = UDim2.new(0, 0, 0.72, 10)
buttonFrame.BackgroundColor3 = colors.darker
buttonFrame.BackgroundTransparency = 0.2
buttonFrame.BorderSizePixel = 0
buttonFrame.ZIndex = 5
buttonFrame.Parent = executorContent

local buttonFrameCorner = Instance.new("UICorner")
buttonFrameCorner.CornerRadius = UDim.new(0, 15)
buttonFrameCorner.Parent = buttonFrame

local buttonContainer = Instance.new("Frame")
buttonContainer.Name = "ButtonContainer"
buttonContainer.Size = UDim2.new(1, -40, 1, -20)
buttonContainer.Position = UDim2.new(0, 20, 0, 10)
buttonContainer.BackgroundTransparency = 1
buttonContainer.ZIndex = 6
buttonContainer.Parent = buttonFrame

-- 创建按钮
local buttonConfigs = {
    {name = "执行", color = colors.primary, position = 0},
    {name = "清除", color = colors.secondary, position = 0.25},
    {name = "注入", color = colors.accent, position = 0.5},
    {name = "保存", color = colors.success, position = 0.75}
}

local buttons = {}

for i, config in ipairs(buttonConfigs) do
    local button = Instance.new("TextButton")
    button.Name = config.name .. "Button"
    button.Size = UDim2.new(0.23, 0, 1, 0)
    button.Position = UDim2.new(config.position, 0, 0, 0)
    button.BackgroundColor3 = config.color
    button.BackgroundTransparency = 0.2
    button.Text = config.name
    button.TextColor3 = colors.text
    button.Font = Enum.Font.GothamBold
    button.TextSize = 18
    button.ZIndex = 7
    button.Parent = buttonContainer
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 10)
    btnCorner.Parent = button
    
    buttons[config.name] = button
end

-- 创建UI球（最小化状态）
local uiBall = Instance.new("ImageButton")
uiBall.Name = "UIBall"
uiBall.Size = UDim2.new(0, 70, 0, 70)
uiBall.Position = UDim2.new(0.5, 0, 0.5, 0)
uiBall.AnchorPoint = Vector2.new(0.5, 0.5)
uiBall.BackgroundColor3 = colors.dark
uiBall.BackgroundTransparency = 0.1
uiBall.Image = "rbxassetid://78752306566484"
uiBall.ImageColor3 = Color3.fromRGB(200, 230, 255)
uiBall.ScaleType = Enum.ScaleType.Fit
uiBall.Visible = false
uiBall.ZIndex = 10
uiBall.Parent = ScreenGui

local ballCorner = Instance.new("UICorner")
ballCorner.CornerRadius = UDim.new(1, 0)
ballCorner.Parent = uiBall

local ballGlow = Instance.new("UIStroke")
ballGlow.Color = colors.accent
ballGlow.Thickness = 4
ballGlow.Transparency = 0.2
ballGlow.Parent = uiBall

-- 球拖动功能（修复版）
local isDraggingBall = false
local dragStartPos, ballStartPos

uiBall.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDraggingBall = true
        dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
        ballStartPos = Vector2.new(uiBall.Position.X.Offset, uiBall.Position.Y.Offset)
        uiBall.ZIndex = 11 -- 提高ZIndex确保在最上层
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isDraggingBall and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
        local newX = ballStartPos.X + delta.X
        local newY = ballStartPos.Y + delta.Y
        
        -- 确保球不会移出屏幕
        local viewportSize = workspace.CurrentCamera.ViewportSize
        newX = math.clamp(newX, 35, viewportSize.X - 35)
        newY = math.clamp(newY, 35, viewportSize.Y - 35)
        
        uiBall.Position = UDim2.new(0, newX, 0, newY)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDraggingBall = false
        uiBall.ZIndex = 10 -- 恢复ZIndex
    end
end)

-- 霓虹脉冲效果
local pulseEffect = Instance.new("UIGradient")
pulseEffect.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, colors.primary),
    ColorSequenceKeypoint.new(0.5, colors.accent),
    ColorSequenceKeypoint.new(1, colors.primary)
})
pulseEffect.Rotation = 45
pulseEffect.Enabled = true
pulseEffect.Parent = mainFrame

-- 更新输出函数
local function updateOutput(message, color)
    outputText.TextColor3 = color or colors.text
    outputText.Text = ">> " .. tostring(message) .. "\n" .. outputText.Text
    
    -- 更新滚动条位置
    wait()
    outputContent.CanvasSize = UDim2.new(0, 0, 0, outputText.TextBounds.Y + 20)
    outputContent.CanvasPosition = Vector2.new(0, outputText.TextBounds.Y)
end

-- 执行脚本函数
local function executeScript()
    local scriptCode = inputBox.Text
    
    if scriptCode and scriptCode ~= "" and not inputBox.Text:find("在此处粘贴脚本代码") then
        updateOutput("正在执行脚本...", colors.accent)
        
        local success, result = pcall(function()
            -- 尝试从字符串中提取loadstring
            local loadPattern = "loadstring%(%s*game:HttpGet%(%s*['\"](.-)['\"]%s*%)%s*%)%s*%(%)"
            local url = scriptCode:match(loadPattern)
            
            if url then
                updateOutput("检测到远程脚本: " .. url, colors.primary)
            end
            
            local fn, err = loadstring(scriptCode)
            if fn then
                return fn()
            else
                error(err)
            end
        end)
        
        if success then
            updateOutput("脚本执行成功!", colors.success)
        else
            updateOutput("执行错误: " .. tostring(result), colors.error)
        end
    else
        updateOutput("请输入脚本代码", colors.error)
    end
end

-- 清除输出函数
local function clearOutput()
    outputText.Text = ">> 输出日志已清除"
    wait()
    outputContent.CanvasSize = UDim2.new(0, 0, 0, outputText.TextBounds.Y + 20)
    updateOutput("就绪...", colors.text)
end

-- 注入函数
local function injectScript()
    updateOutput("注入功能已激活", colors.accent)
    -- 这里可以添加自定义注入逻辑
end

-- 保存函数
local function saveScript()
    if inputBox.Text and inputBox.Text ~= "" and not inputBox.Text:find("在此处粘贴脚本代码") then
        updateOutput("脚本已保存到本地", colors.success)
    else
        updateOutput("没有内容可保存", colors.error)
    end
end

-- 缩放动画（修复版）
local isMinimized = false
local isAnimating = false

local function toggleScale()
    if isAnimating then return end
    isAnimating = true
    
    if isMinimized then
        -- 恢复UI
        background.Visible = true
        
        local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
        
        local tween1 = TweenService:Create(background, tweenInfo, {
            BackgroundTransparency = 0.3
        })
        
        local tween2 = TweenService:Create(mainFrame, tweenInfo, {
            Size = UDim2.new(1, -10, 1, -10),
            BackgroundTransparency = 0.05
        })
        
        local tween3 = TweenService:Create(uiBall, tweenInfo, {
            Size = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1,
            ImageTransparency = 1
        })
        
        tween1:Play()
        tween2:Play()
        tween3:Play()
        
        tween3.Completed:Connect(function()
            uiBall.Visible = false
            isMinimized = false
            isAnimating = false
        end)
        
        pulseEffect.Enabled = true
    else
        -- 缩放成球
        local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Quart, Enum.EasingDirection.InOut)
        
        local tween1 = TweenService:Create(mainFrame, tweenInfo, {
            Size = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1
        })
        
        local tween2 = TweenService:Create(background, tweenInfo, {
            BackgroundTransparency = 1
        })
        
        tween1:Play()
        tween2:Play()
        
        tween1.Completed:Connect(function()
            background.Visible = false
            
            uiBall.Visible = true
            uiBall.Size = UDim2.new(0, 0, 0, 0)
            uiBall.BackgroundTransparency = 1
            uiBall.ImageTransparency = 1
            uiBall.Position = UDim2.new(0.5, 0, 0.5, 0)
            
            local tween3 = TweenService:Create(uiBall, tweenInfo, {
                Size = UDim2.new(0, 70, 0, 70),
                BackgroundTransparency = 0.1,
                ImageTransparency = 0
            })
            
            tween3:Play()
            
            tween3.Completed:Connect(function()
                isMinimized = true
                isAnimating = false
            end)
        end)
        
        pulseEffect.Enabled = false
    end
end

-- 按钮事件
buttons["执行"].MouseButton1Click:Connect(executeScript)
buttons["清除"].MouseButton1Click:Connect(clearOutput)
buttons["注入"].MouseButton1Click:Connect(injectScript)
buttons["保存"].MouseButton1Click:Connect(saveScript)
scaleButton.MouseButton1Click:Connect(toggleScale)
uiBall.MouseButton1Click:Connect(toggleScale)

-- 按钮悬停效果（优化版）
local function setupButtonHover(button, baseColor, hoverColor)
    button.MouseEnter:Connect(function()
        if isAnimating then return end
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = hoverColor,
            BackgroundTransparency = 0.1,
            Size = UDim2.new(0.23, 5, 1, 5),
            Position = UDim2.new(button.Position.X.Scale, -2.5, 0, -2.5)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        if isAnimating then return end
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = baseColor,
            BackgroundTransparency = 0.2,
            Size = UDim2.new(0.23, 0, 1, 0),
            Position = UDim2.new(button.Position.X.Scale, 0, 0, 0)
        }):Play()
    end)
end

-- 设置按钮悬停效果
setupButtonHover(buttons["执行"], colors.primary, Color3.fromRGB(0, 200, 255))
setupButtonHover(buttons["清除"], colors.secondary, Color3.fromRGB(0, 130, 230))
setupButtonHover(buttons["注入"], colors.accent, Color3.fromRGB(50, 255, 255))
setupButtonHover(buttons["保存"], colors.success, Color3.fromRGB(50, 255, 180))

-- 缩放按钮悬停效果
scaleButton.MouseEnter:Connect(function()
    if isAnimating then return end
    TweenService:Create(scaleButton, TweenInfo.new(0.2), {
        BackgroundColor3 = colors.error,
        BackgroundTransparency = 0.1,
        Rotation = 90
    }):Play()
end)

scaleButton.MouseLeave:Connect(function()
    if isAnimating then return end
    TweenService:Create(scaleButton, TweenInfo.new(0.2), {
        BackgroundColor3 = colors.dark,
        BackgroundTransparency = 0.4,
        Rotation = 0
    }):Play()
end)

-- 选项卡切换
for tabId, tabData in pairs(tabButtons) do
    tabData.button.MouseButton1Click:Connect(function()
        if currentTab == tabId or isAnimating then return end
        
        currentTab = tabId
        
        for otherId, otherData in pairs(tabButtons) do
            otherData.indicator.Visible = (otherId == tabId)
            
            TweenService:Create(otherData.button, TweenInfo.new(0.2), {
                BackgroundTransparency = (otherId == tabId) and 0.3 or 0.5
            }):Play()
        end
    end)
end

-- 脉冲动画（优化版）
local pulseConnection
local function startPulseAnimation()
    if pulseConnection then
        pulseConnection:Disconnect()
    end
    
    pulseConnection = RunService.Heartbeat:Connect(function(delta)
        if isAnimating then return end
        
        local time = tick()
        local pulse = (math.sin(time * 1.5) + 1) / 2
        
        borderGlow.Transparency = 0.1 + pulse * 0.15
        inputGlow.Transparency = 0.2 + pulse * 0.1
        outputGlow.Transparency = 0.2 + pulse * 0.1
        
        if isMinimized then
            ballGlow.Transparency = 0.2 + pulse * 0.2
            local pulseScale = 1 + pulse * 0.1
            uiBall.Size = UDim2.new(0, 70 * pulseScale, 0, 70 * pulseScale)
        end
        
        pulseEffect.Offset = Vector2.new(pulse * 0.5, pulse * 0.5)
    end)
end

startPulseAnimation()

-- 输入框事件
inputBox.Focused:Connect(function()
    if inputBox.Text:find("在此处粘贴脚本代码") then
        inputBox.Text = ""
        inputBox.TextColor3 = colors.text
    end
    
    TweenService:Create(inputGlow, TweenInfo.new(0.2), {
        Thickness = 4,
        Transparency = 0.1
    }):Play()
end)

inputBox.FocusLost:Connect(function()
    if inputBox.Text == "" then
        inputBox.Text = "-- 在此处粘贴脚本代码\n-- 支持 loadstring 格式\n-- 例如：loadstring(game:HttpGet('https://example.com/script.lua'))()"
        inputBox.TextColor3 = Color3.fromRGB(150, 180, 220)
    end
    
    TweenService:Create(inputGlow, TweenInfo.new(0.2), {
        Thickness = 2,
        Transparency = 0.2
    }):Play()
end)

-- 更新输入框滚动区域
inputBox:GetPropertyChangedSignal("Text"):Connect(function()
    wait()
    scriptInput.CanvasSize = UDim2.new(0, 0, 0, inputBox.TextBounds.Y + 20)
end)

-- 初始化完成
updateOutput("培根执行器已加载!", colors.accent)
updateOutput("UI全屏显示，点击X按钮缩放", colors.primary)
updateOutput("UI球可拖动，点击恢复全屏", colors.text)

-- 添加一些装饰性元素
local decorations = Instance.new("Frame")
decorations.Name = "Decorations"
decorations.Size = UDim2.new(1, 0, 1, 0)
decorations.BackgroundTransparency = 1
decorations.ZIndex = 1
decorations.Parent = mainFrame

-- 创建一些装饰性光点
for i = 1, 15 do
    local dot = Instance.new("Frame")
    dot.Size = UDim2.new(0, math.random(3, 6), 0, math.random(3, 6))
    dot.Position = UDim2.new(math.random() * 0.95, 0, math.random() * 0.95, 0)
    dot.BackgroundColor3 = colors.accent
    dot.BackgroundTransparency = 0.9
    dot.BorderSizePixel = 0
    dot.ZIndex = 1
    dot.Parent = decorations
    
    spawn(function()
        while dot and dot.Parent do
            local tween = TweenService:Create(dot, TweenInfo.new(math.random(1.5, 3)), {
                BackgroundTransparency = math.random(8, 9.5) / 10,
                Position = UDim2.new(math.random() * 0.95, 0, math.random() * 0.95, 0)
            })
            tween:Play()
            wait(math.random(1.5, 3))
        end
    end)
end

-- 添加键盘快捷键
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F9 then
        executeScript()
    elseif input.KeyCode == Enum.KeyCode.F10 then
        toggleScale()
    end
end)
